<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendar - Initial Research</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!--cms-->
    <script src="/content-loader.js"></script>
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    <script src="https://unpkg.com/netlify-cms@^2.0.0/dist/netlify-cms.js"></script>
    <!-- Import shared navigation styles and scripts -->
    <link rel="stylesheet" href="../css/navigation.css">
    <script src="../js/navigation.js"></script>
    
    <style>
       
        /* content */
        /* Section header - updated style */
        .section-header {
            display: flex;
            align-items: center;
            margin: 40px 0 40px 0; /* Match demo page spacing */
        }
        
        .section-heading {
            font-size: 43px; /* Match demo page */
            font-weight: 400; /* Match demo page */
            margin: 0;
            line-height: 1.2;
            text-transform: uppercase;
            display: none; /* Hide the heading since we're using tabs */
        }
        
        /* Tab container */
        .tab-container {
            display: flex;
            gap: 2vw;
        }
        
        .tab {
            font-size: 24px; /* Reduced from 43px to match section headings */
            font-weight: 400; /* Match demo page weight */
            cursor: pointer;
            transition: color 0.3s ease;
            line-height: 1.2;
            position: relative;
        }
        
        .tab.active {
            color: rgb(115, 114, 114);
        }
        
        .tab.inactive {
            color: rgb(29, 29, 29);
        }
        
        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -0.5vh;
            left: 0;
            width: 100%;
            height: 3px;
            background-color: rgb(115, 114, 114);
        }
        
        /* Programs table - updated styling */
        .programs-table {
            width: 97%;
            border-collapse: collapse;
            font-family: 'Space Grotesk', Helvetica, Arial, sans-serif;
            font-weight: 300;
            position: relative;
            z-index: 2;
        }
        
        .programs-table tr {
            transition: background-color 0.2s ease;
            position: relative;
        }
        
        .programs-table tr:hover {
            background-color: rgb(115, 115, 115);
            cursor: pointer;
        }
        
        .programs-table td {
            padding: 15px 16px; /* Match demo page */
            vertical-align: top;
            border-bottom: 1px solid rgb(43, 43, 43);
        }
        
        .date-column {
            width: 15%;
            font-size: 16px; /* Match demo page */
        }
        
        .title-column {
            width: 85%;
            font-size: 18px; /* Match demo page */
        }
        
        /* No events message */
        .no-events {
            font-size: 18px; /* Match demo page */
            margin: 3vh 0;
            font-style: italic;
            color: rgb(100, 100, 100);
        }
        
        /* Dynamic rectangle container */
        .rectangle-container {
            position: fixed;
            top: 0;
            right: 0;
            width: 50%;
            height: 100vh;
            z-index: 100;
            pointer-events: none;
            overflow-y: auto;
        }
        
        .hover-rectangle {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            z-index: 1001;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: stretch; /* Changed from center to stretch for proper alignment */
            padding: 5vh 20% 5vh 20%; /* Restored original padding */
            box-sizing: border-box;
            color: white;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }
        
        .event-detail-view {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgb(43, 43, 43);
            padding: 5vh 20% 5vh 20%; /* 20% padding on each side = 60% content width */
            box-sizing: border-box;
            color: white;
            display: none;
            flex-direction: column;
            overflow-y: auto;
            pointer-events: auto;
            align-items: stretch; /* Changed from center to stretch for proper alignment */
        }
        
        /* Close button */
        .close-button {
            position: absolute;
            top: 2vh;
            right: 2vw;
            font-size: 1.5vw;
            color: white;
            background: none;
            border: none;
            cursor: pointer;
            z-index: 1002;
        }
        
        /* Event title styling */
        .event-title {
            text-align: center;
            margin-top: 6vh;
            margin-bottom: 3vh;
            width: 100%; /* Ensure full width within centered container */
        }
        
        .event-title h2 {
            font-size: 30px;
            margin: 0 0 0.5vh 0;
            font-weight: 500;
        }
        
        .event-title h3 {
            font-size: 1.5vw;
            margin: 0;
            font-weight: 200;
        }
        
        /* Event image styling */
        .event-image {
            width: 100%;
            /* height: auto; */
            max-height: 60vh;
            object-fit: contain;
            margin-bottom: 3vh;
        }
        
        /* Event date styling - UPDATED FOR LEFT ALIGNMENT WITH FLEX LAYOUT */
        .event-date {
            display: flex; /* Use flexbox for inline layout */
            justify-content: space-between; /* Time on left, RSVP on right */
            align-items: flex-end; /* Align items to bottom baseline */
            margin-bottom: 3vh;
            width: 100%;
        }
        
        .event-date p {
            font-size: 1.2vw;
            margin: 0 0 0.5vh 0;
            font-weight: 300;
        }
        
        /* Time container for grouping date and time */
        .time-container {
            display: flex;
            flex-direction: column;
            text-align: left;
        }
        
        /* NEW: Hover state event date - moved to bottom with same design */
        .hover-rectangle .event-date {
            order: 10;
            margin-top: auto;
            margin-bottom: 2vh;
            display: block;
            text-align: center;
            width: 100%;
            font-size: 30px;
        }

        .hover-rectangle .event-image {
            position: absolute;
            width: 60%;
            top: 235px;
            left: 50%;                    /* Move to center */
            transform: translateX(-50%);  /* Offset by half its width */
            max-height: 60vh;
            object-fit: contain;
            margin-bottom: 3vh;
        }
        
        .hover-rectangle .event-date .time-container {
            display: block;
            text-align: center;
        }
        .hover-rectangle .event-date .time-container p {
            text-align: center;
            margin: 0 0 0.5vh 0;
            display: block;
            font-size: 20px;
            font-weight: 300;
        }
        
        /* Event description */
        .event-description {
            margin-left: auto;
            margin-right: auto;
            text-align: left;
            margin-bottom: 4vh;
            width: 100%; /* Use full width within centered container */
            line-height: 1.6;
        }
        
        .event-description p {
            font-size: 15px;
            margin: 0 0 1vh 0;
        }
        
        /* RSVP button - UPDATED FOR INLINE LAYOUT WITH TIME */
        .rsvp-button {
            width: auto; /* Natural width for inline layout */
            max-width: 300px; 
            padding: 1vh 2vw;
            background-color: transparent; 
            color: white;
            border: 1px solid white; 
            font-size: 1.2vw;
            cursor: pointer;
            font-family: 'Space Grotesk', sans-serif;
            transition: all 0.3s ease;
            border-radius: 0;
            margin-bottom: 0; /* Remove bottom margin since it's inline */
            font-weight: 400;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            flex-shrink: 0; /* Prevent button from shrinking */
        }
        
        .rsvp-button:hover {
            background-color: white; /* White background on hover */
            color: rgb(43, 43, 43); /* Dark text on hover to match desktop background */
        }
        
        /* Colors for rectangles */
        .rectangle-colors {
            display: none;
        }
        .hover-rectangle .rsvp-button {
            display: none; /* Hide RSVP button during hover */
        }
        
        /* Mobile popup overlay - UPDATED WITH OUTLINE */
        .mobile-popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8); /* Semi-transparent overlay */
            z-index: 2000;
            display: none;
            justify-content: center;
            align-items: center;
            padding: 5vh;
            box-sizing: border-box;
        }
        
        .mobile-popup-content {
            width: 90%;
            max-width: 500px;
            max-height: 85vh;
            background-color: #8B7355; /* Brown background */
            border-radius: 0; /* No rounded corners */
            overflow-y: auto;
            position: relative;
            padding: 3vh 4vw;
            box-sizing: border-box;
            display: block;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            color: white; /* White text on brown background */
            border: 4px solid #ffffff; /* This will be overridden by JavaScript with random color */
        }
        
        .mobile-close-button {
            position: absolute;
            top: 2vh;
            right: 3vw;
            background: none;
            border: none;
            color: white; /* White color for brown background */
            font-size: 1.2rem;
            cursor: pointer;
            z-index: 2001;
            padding: 5px;
            line-height: 1;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 0;
            font-weight: 300;
        }
        
        .mobile-close-button:hover {
            background-color: rgba(255, 255, 255, 0.1); /* Subtle hover effect */
        }
        
        @media (max-width: 768px) {
            /* Calendar-specific mobile styles */
            .section-heading {
                font-size: 20px;
            }
            
            .tab {
                font-size: 20px; /* Reduced for mobile */
            }
            
            .tab-container {
                gap: 5vw;
            }
            
            .date-column {
                font-size: 16px;
            }
            
            .title-column {
                font-size: 16px;
            }
            
            .no-events {
                font-size: 16px;
            }
            
            /* Hide desktop rectangle container on mobile */
            .rectangle-container {
                display: none !important;
            }
            
            /* Mobile popup styles - RESPONSIVE UPDATES */
            .mobile-popup-overlay {
                padding: 3vh;
            }
            
            .mobile-popup-content {
                width: 90%;
                max-width: 450px;
                padding: 2.5vh 3.5vw;
                border-radius: 0;
                background-color: #1f0f07; /* Brown background */
                color: white; /* White text */
                border: 4px solid #ffffff; /* This will be overridden by JavaScript with random color */
            }
            
            .mobile-popup-content .event-title {
                text-align: center;
                margin-top: 0.5vh;
                margin-bottom: 2vh;
                border-bottom: none; /* Remove separator line */
                padding-bottom: 1.5vh;
            }
            
            .mobile-popup-content .event-title h2 {
                font-size: 5.5vw;
                margin: 0 0 0.5vh 0;
                font-weight: 400;
                line-height: 1.2;
                color: white; /* White color */
                text-transform: none; /* Remove uppercase */
                letter-spacing: 0.02em;
            }
            
            .mobile-popup-content .event-title h3 {
                font-size: 4vw;
                margin: 0;
                font-weight: 300;
                line-height: 1.2;
                color: rgba(255, 255, 255, 0.8); /* Slightly dimmed white for subtitle */
                font-style: italic;
            }
            
            .mobile-popup-content .event-image {
                width: 100%;
                height: auto;
                max-height: 25vh;
                object-fit: contain;
                margin-bottom: 2vh;
                display: block;
                border-radius: 0;
                border: none; /* Remove border around image */
            }
            
            .mobile-popup-content .event-date {
                text-align: center;
                margin-bottom: 2vh;
                padding: 1vh 0;
                background-color: transparent; /* Remove background */
                display: block; /* Ensure block layout for mobile */
            }
            
            .mobile-popup-content .event-date p {
                font-size: 3.5vw;
                margin: 0 0 0.3vh 0;
                font-weight: 400;
                line-height: 1.3;
                color: white; /* White color */
                display: block; /* Each paragraph on its own line */
            }
            
            .mobile-popup-content .event-description {
                text-align: left;
                margin-bottom: 2vh;
                line-height: 1.7;
                padding: 1vh 0;
            }
            
            .mobile-popup-content .event-description p {
                font-size: 3vw;
                line-height: 1.7;
                margin: 0;
                color: white; /* White color */
                font-weight: 300;
            }
            
            .mobile-popup-content .rsvp-button {
                font-size: 3.5vw;
                padding: 2vh 4vw;
                width: 100%;
                background-color: transparent; /* Transparent background */
                color: white;
                border: 1px solid white; /* White border */
                cursor: pointer;
                font-family: 'Space Grotesk', sans-serif;
                transition: all 0.3s ease;
                border-radius: 0;
                margin-top: 2vh;
                font-weight: 400;
                text-transform: uppercase;
                letter-spacing: 0.1em;
                margin-left: auto; /* Center the button */
                margin-right: auto; /* Center the button */
                display: block; /* Ensure block display for centering */
            }
            
            .mobile-popup-content .rsvp-button:hover {
                background-color: white; /* White background on hover */
                color: #2b1a06; /* Brown text on hover */
            }
            
            .mobile-close-button {
                font-size: 4vw;
                top: 1.5vh;
                right: 3vw;
                padding: 0.5vh 1vh;
                position: absolute !important;
                border-radius: 0;
                background: none;
                width: auto;
                height: auto;
                color: white; /* White color for brown background */
                font-weight: 300;
            }
            
            .mobile-close-button:hover {
                background-color: rgba(255, 255, 255, 0.1); /* Subtle hover effect */
            }
        }
        
     
        /* Auto-switch to desktop when screen is larger than 768px */
        @media (min-width: 769px) {
          
            
          
            /* Make sure mobile popup is completely hidden on desktop */
            .mobile-popup-overlay {
                display: none !important;
            }
        }
    </style>
</head>
<body>
    <!-- Top red banner with title and navigation -->
   
    <!-- Store colors in data attributes -->
    <div class="rectangle-colors" 
         data-colors='["rgb(51, 25, 0)",  "#3b2b1d", "rgb(70, 0, 0)",  "#3b2b1d", "rgb(39, 39, 39)", "rgb(59, 40, 40)"]'>
    </div>
    
    <!-- Rectangle container for hover effect and detailed view -->
    <div class="rectangle-container">
        <div class="hover-rectangle" id="rectangle-1">
            <div class="event-title">
                <h2>The Girl with a Pistol</h2>
                <h3>screening</h3>
            </div>
            <img src="img/upcomings/1.jpg" alt="The Girl with a Pistol" class="event-image">
            <div class="event-date">
                <div class="time-container">
                    <p>March 29th Saturday 2025</p>
                    <p>2pm to 6pm</p>
                </div>
                <button class="rsvp-button">RSVP</button>
            </div>
        </div>
        
        <div class="event-detail-view" id="event-details">
            <button class="close-button" id="close-detail">✕</button>
            <div class="event-title">
                <h2 id="detail-title">Event Title</h2>
                <h3 id="detail-subtitle">subtitle</h3>
            </div>
            <img id="detail-image" src="img/upcomings/1.jpg" alt="Event Image" class="event-image">
            <div class="event-date">
                <div class="time-container">
                    <p id="detail-date">Date</p>
                    <p id="detail-time">Time</p>
                </div>
                <button class="rsvp-button" id="rsvp-button">RSVP</button>
            </div>
            <div class="event-description">
                <p id="detail-description">Event description will appear here.</p>
            </div>
        </div>
    </div>
    
    <!-- Mobile popup overlay -->
    <div class="mobile-popup-overlay" id="mobile-popup-overlay">
        <div class="mobile-popup-content" id="mobile-popup-content">
            <button class="mobile-close-button" id="mobile-close-button">✕</button>
            <div class="event-title">
                <h2 id="mobile-detail-title">Event Title</h2>
                <h3 id="mobile-detail-subtitle">subtitle</h3>
            </div>
            <img id="mobile-detail-image" src="img/upcomings/1.jpg" alt="Event Image" class="event-image">
            <div class="event-date">
                <p id="mobile-detail-date">Date</p>
                <p id="mobile-detail-time">Time</p>
            </div>
            <div class="event-description">
                <p id="mobile-detail-description">Event description will appear here.</p>
            </div>
            <button class="rsvp-button" id="mobile-rsvp-button">RSVP</button>
        </div>
    </div>
    
    <!-- Content area with toggle switch -->
    <div class="content">
        <div class="section-header">
            <h2 class="section-heading" id="section-title">upcoming</h2>
            <div class="tab-container">
                <div class="tab active" id="upcoming-tab">Upcoming</div>
                <div class="tab inactive" id="past-tab">Past</div>
            </div>
        </div>
        
        <div id="upcoming-container">
            <table class="programs-table" id="upcoming-table">
                <tbody>
                    <!-- Table will be populated by JavaScript -->
                </tbody>
            </table>
            <p class="no-events" id="no-upcoming" style="display: none;">No upcoming events scheduled.</p>
        </div>
        
        <div id="past-container" style="display: none;">
            <table class="programs-table" id="past-table">
                <tbody>
                    <!-- Table will be populated by JavaScript -->
                </tbody>
            </table>
            <p class="no-events" id="no-past" style="display: none;">No past events to display.</p>
        </div>
    </div>
    
   
   
</footer>
    
    <script>
          function goToHomepage() {
            window.location.href = '../index.html';
        }
        // Mobile navigation functions - matching demo page
        function toggleMobileNav() {
            const mobileNav = document.getElementById('mobileNav');
            
            if (mobileNav.style.display === 'flex' || mobileNav.classList.contains('show')) {
                mobileNav.style.display = 'none';
                mobileNav.classList.remove('show');
                // Close all mobile dropdowns when closing nav
                const allMobileNavItems = document.querySelectorAll('.mobile-nav-item');
                allMobileNavItems.forEach(item => {
                    item.classList.remove('active');
                });
            } else {
                mobileNav.style.display = 'flex';
                mobileNav.classList.add('show');
            }
        }
        
        // Mobile dropdown toggle
        function toggleMobileDropdown(event, element) {
            event.preventDefault();
            const navItem = element.parentElement;
            
            // Check if this nav item has a dropdown
            const dropdown = navItem.querySelector('.mobile-dropdown');
            if (!dropdown) {
                // If no dropdown, it's a regular link
                return;
            }
            
            // Close all other mobile dropdowns
            const allMobileNavItems = document.querySelectorAll('.mobile-nav-item');
            allMobileNavItems.forEach(item => {
                if (item !== navItem) {
                    item.classList.remove('active');
                }
            });
            
            // Toggle current dropdown
            navItem.classList.toggle('active');
        }

        // FIXED: Add event data with proper date creation for NYC timezone
        const events = [
            { 
                id: 1, 
                // Create date in NYC timezone by specifying the date string with timezone
                date: new Date('2025-05-20T23:59:59.999-04:00'), // May 16, 2025 end of day in EDT
                title: "Summer Exhibition Opening",
                displayDate: "05.20.25",
                subtitle: "exhibition",
                image: "img/upcomings/1.jpg",
                timeDisplay: "6pm to 9pm",
                description: "Join us for the opening reception of our Summer Exhibition featuring works by emerging artists exploring themes of ecology, community, and speculative futures. The exhibition brings together paintings, sculptures, video installations, and interactive works that envision alternative ways of being in relation to our environment and each other. Refreshments will be served.",
                rsvpLink: "https://example.com/rsvp/summer-exhibition"
            },
            { 
                id: 2, 
                date: new Date('2025-05-25T23:59:59.999-04:00'), 
                title: "Artist Talk: Maria Garcia",
                displayDate: "05.25.25",
                subtitle: "lecture",
                image: "img/upcomings/2.jpg",
                timeDisplay: "7pm to 8:30pm",
                description: "Acclaimed artist Maria Garcia discusses her recent work examining the intersection of digital technology and traditional craft practices. Garcia will present her methodology and research process, followed by a Q&A session. This talk is presented in collaboration with the Digital Arts Foundation and is part of our ongoing series on contemporary art practices.",
                rsvpLink: "https://example.com/rsvp/maria-garcia-talk"
            },
            { 
                id: 3, 
                date: new Date('2025-07-22T23:59:59.999-04:00'), 
                title: "Experimental Film Night",
                displayDate: "07.22.25",
                subtitle: "screening",
                image: "img/upcomings/1.jpg",
                timeDisplay: "8pm to 10pm",
                description: "A curated selection of experimental short films by international filmmakers pushing the boundaries of the medium. The program includes works that explore non-narrative structures, alternative production techniques, and expanded cinema practices. Each screening will be followed by a brief discussion led by film curator Alex Wong.",
                rsvpLink: "https://example.com/rsvp/experimental-film"
            }
            
        ];
        
        // Function to setup click for detailed view
        function setupDetailView() {
            const upcomingRows = document.querySelectorAll('#upcoming-table tr');
            const pastRows = document.querySelectorAll('#past-table tr');
            const detailView = document.getElementById('event-details');
            const mobilePopup = document.getElementById('mobile-popup-overlay');
            const mobilePopupContent = document.getElementById('mobile-popup-content');
            const closeButton = document.getElementById('close-detail');
            const mobileCloseButton = document.getElementById('mobile-close-button');
            
            // Check if we're on mobile
            function isMobile() {
                return window.innerWidth <= 768;
            }
            
            // Function to show event details
            function showEventDetails(event) {
                // Get a random color from the array
                const colorsData = document.querySelector('.rectangle-colors').getAttribute('data-colors');
                const colors = JSON.parse(colorsData);
                const randomColor = colors[Math.floor(Math.random() * colors.length)];
                
                // Format the date
                const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                const formattedDate = event.date.toLocaleDateString('en-US', options);
                
                if (isMobile()) {
                    // Mobile popup
                    const mobileDetailTitle = document.getElementById('mobile-detail-title');
                    const mobileDetailSubtitle = document.getElementById('mobile-detail-subtitle');
                    const mobileDetailImage = document.getElementById('mobile-detail-image');
                    const mobileDetailDate = document.getElementById('mobile-detail-date');
                    const mobileDetailTime = document.getElementById('mobile-detail-time');
                    const mobileDetailDescription = document.getElementById('mobile-detail-description');
                    const mobileRsvpButton = document.getElementById('mobile-rsvp-button');
                    
                    mobileDetailTitle.textContent = event.title;
                    mobileDetailSubtitle.textContent = event.subtitle;
                    mobileDetailImage.src = event.image;
                    mobileDetailImage.alt = event.title;
                    mobileDetailDate.textContent = formattedDate;
                    mobileDetailTime.textContent = event.timeDisplay;
                    mobileDetailDescription.textContent = event.description;
                    
                    // Apply random color to the popup border
                    mobilePopupContent.style.borderColor = randomColor;
                    
                    // Show mobile popup with flex display for centering
                    mobilePopup.style.display = 'flex';
                    
                    // RSVP button event listener (remove any existing ones first)
                    mobileRsvpButton.replaceWith(mobileRsvpButton.cloneNode(true));
                    const newMobileRsvpButton = document.getElementById('mobile-rsvp-button');
                    newMobileRsvpButton.addEventListener('click', function() {
                        if (event.rsvpLink) {
                            window.open(event.rsvpLink, '_blank');
                        } else {
                            alert('Thank you for your RSVP to ' + event.title + '! We\'ll send you more details via email.');
                        }
                    });
                } else {
                    // Desktop detail view
                    const detailTitle = document.getElementById('detail-title');
                    const detailSubtitle = document.getElementById('detail-subtitle');
                    const detailImage = document.getElementById('detail-image');
                    const detailDate = document.getElementById('detail-date');
                    const detailTime = document.getElementById('detail-time');
                    const detailDescription = document.getElementById('detail-description');
                    const rsvpButton = document.getElementById('rsvp-button');
                    
                    // Immediately hide the hover effect
                    document.getElementById('rectangle-1').style.opacity = '0';
                    
                    detailTitle.textContent = event.title;
                    detailSubtitle.textContent = event.subtitle;
                    detailImage.src = event.image;
                    detailImage.alt = event.title;
                    detailDate.textContent = formattedDate;
                    detailTime.textContent = event.timeDisplay;
                    detailDescription.textContent = event.description;
                    detailView.style.backgroundColor = randomColor;
                    
                    // Show the detail view
                    setTimeout(function() {
                        detailView.style.display = 'flex';
                    }, 10);
                    
                    // RSVP button event listener (remove any existing ones first)
                    rsvpButton.replaceWith(rsvpButton.cloneNode(true));
                    const newRsvpButton = document.getElementById('rsvp-button');
                    newRsvpButton.addEventListener('click', function() {
                        if (event.rsvpLink) {
                            window.open(event.rsvpLink, '_blank');
                        } else {
                            alert('Thank you for your RSVP to ' + event.title + '! We\'ll send you more details via email.');
                        }
                    });
                }
            }
            
            // Set up click event for each upcoming event row
            upcomingRows.forEach(row => {
                const eventId = row.getAttribute('data-rectangle');
                const event = events.find(e => e.id == eventId);
                
                if (event) {
                    row.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        showEventDetails(event);
                    });
                }
            });
            
            // Set up click event for each past event row (redirect to external link)
            pastRows.forEach(row => {
                const eventId = row.getAttribute('data-rectangle');
                const event = events.find(e => e.id == eventId);
                
                if (event && event.link) {
                    row.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        window.open(event.link, '_blank');
                    });
                    
                    row.style.cursor = 'pointer';
                    row.setAttribute('title', 'Click to view more details');
                }
            });
            
            // Close button event listeners
            closeButton.addEventListener('click', function() {
                detailView.style.display = 'none';
                document.getElementById('rectangle-1').style.opacity = '0';
            });
            
            // Close mobile popup when clicking close button
            mobileCloseButton.addEventListener('click', function() {
                mobilePopup.style.display = 'none';
            });
            
            // Close mobile popup when clicking on overlay background
            mobilePopup.addEventListener('click', function(e) {
                if (e.target === mobilePopup) {
                    mobilePopup.style.display = 'none';
                }
            });
        }
        
        // FIXED: Simplified function to get current date and time in New York timezone
        function getCurrentNYDateTime() {
            // Get current date in New York timezone
            const now = new Date();
            return new Date(now.toLocaleString("en-US", {timeZone: "America/New_York"}));
        }
        
        // Function to initialize the page
        function initializeCalendar() {
            const nowNY = getCurrentNYDateTime(); // Get current datetime in NY timezone
            
            // Separate events into upcoming and past using direct comparison
            const upcomingEvents = events.filter(event => {
                return nowNY <= event.date; // Event is upcoming if current time is before event end
            });
            
            const pastEvents = events.filter(event => {
                return nowNY > event.date; // Event is past if current time is after event end
            }).sort((a, b) => b.date - a.date); // Sort past events by most recent first
            
            // Populate the tables
            populateEventTable('upcoming-table', upcomingEvents);
            populateEventTable('past-table', pastEvents);
            
            // Show "No events" message if needed
            document.getElementById('no-upcoming').style.display = upcomingEvents.length === 0 ? 'block' : 'none';
            document.getElementById('no-past').style.display = pastEvents.length === 0 ? 'block' : 'none';
            
            // Add event listeners for tab switching
            const upcomingTab = document.getElementById('upcoming-tab');
            const pastTab = document.getElementById('past-tab');
            const upcomingContainer = document.getElementById('upcoming-container');
            const pastContainer = document.getElementById('past-container');
            const sectionTitle = document.getElementById('section-title');
            
            // Function to show upcoming events
            function showUpcoming() {
                upcomingContainer.style.display = 'block';
                pastContainer.style.display = 'none';
                upcomingTab.classList.add('active');
                upcomingTab.classList.remove('inactive');
                pastTab.classList.add('inactive');
                pastTab.classList.remove('active');
                sectionTitle.textContent = 'UPCOMING';
            }
            
            // Function to show past events
            function showPast() {
                upcomingContainer.style.display = 'none';
                pastContainer.style.display = 'block';
                upcomingTab.classList.add('inactive');
                upcomingTab.classList.remove('active');
                pastTab.classList.add('active');
                pastTab.classList.remove('inactive');
                sectionTitle.textContent = 'PAST';
            }
            
            // Click handlers for tabs
            upcomingTab.addEventListener('click', showUpcoming);
            pastTab.addEventListener('click', showPast);
            
            // Set up hover effects for event rows
            setupHoverEffects();
            
            // Set up click for detailed view
            setupDetailView();
        }
        
        // Function to populate event tables
        function populateEventTable(tableId, eventsList) {
            const tableBody = document.getElementById(tableId).querySelector('tbody');
            tableBody.innerHTML = '';
            
            eventsList.forEach(event => {
                const row = document.createElement('tr');
                row.setAttribute('data-rectangle', event.id);
                
                const dateCell = document.createElement('td');
                dateCell.className = 'date-column';
                dateCell.textContent = event.displayDate;
                
                const titleCell = document.createElement('td');
                titleCell.className = 'title-column';
                titleCell.textContent = event.title;
                
                row.appendChild(dateCell);
                row.appendChild(titleCell);
                tableBody.appendChild(row);
            });
        }
        
        // Function to setup hover effects
        function setupHoverEffects() {
            const tableRows = document.querySelectorAll('.programs-table tr');
            const rectangle = document.getElementById('rectangle-1');
            
            // Get colors from data attribute
            const colorsData = document.querySelector('.rectangle-colors').getAttribute('data-colors');
            const colors = JSON.parse(colorsData);
            
            tableRows.forEach(row => {
                const eventId = row.getAttribute('data-rectangle');
                const event = events.find(e => e.id == eventId);
                
                if (event) {
                    row.addEventListener('mouseenter', function() {
                        // Only show hover effect on desktop and if detail view is not displayed
                        if (window.innerWidth > 768 && document.getElementById('event-details').style.display !== 'flex') {
                            // Set event details
                            const eventTitle = rectangle.querySelector('.event-title h2');
                            const eventSubtitle = rectangle.querySelector('.event-title h3');
                            const eventImage = rectangle.querySelector('.event-image');
                            const eventDateElement = rectangle.querySelector('.event-date p:first-child');
                            const eventTimeElement = rectangle.querySelector('.event-date p:last-child');
                            
                            eventTitle.textContent = event.title;
                            eventSubtitle.textContent = event.subtitle;
                            eventImage.src = event.image;
                            eventImage.alt = event.title;
                            
                            // Format the date
                            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                            eventDateElement.textContent = event.date.toLocaleDateString('en-US', options);
                            eventTimeElement.textContent = event.timeDisplay;
                            
                            // Get a random color from the array
                            const randomColor = colors[Math.floor(Math.random() * colors.length)];
                            
                            // Set the background color of the rectangle
                            rectangle.style.backgroundColor = randomColor;
                            
                            // Show the rectangle
                            rectangle.style.opacity = '1';
                        }
                    });
                    
                    row.addEventListener('mouseleave', function() {
                        // Only hide hover effect on desktop and if detail view is not displayed
                        if (window.innerWidth > 768 && document.getElementById('event-details').style.display !== 'flex') {
                            // Hide the rectangle when not hovering
                            rectangle.style.opacity = '0';
                        }
                    });
                }
            });
        }
        
        // Automatic check for past events - check every hour
        function setupAutomaticEventCheck() {
            // Check once at page load
            initializeCalendar();
            
            // Set up automatic checks every hour to catch events that end
            setInterval(function() {
                initializeCalendar();
            }, 60 * 60 * 1000); // Check every hour (60 minutes * 60 seconds * 1000 ms)
        }
        
        // Auto-handle screen resize
        window.addEventListener('resize', function() {
            const mobileNav = document.getElementById('mobileNav');
            const allMobileNavItems = document.querySelectorAll('.mobile-nav-item');
            
            // If resizing to desktop width, close mobile nav
            if (window.innerWidth > 768) {
                mobileNav.style.display = 'none';
                mobileNav.classList.remove('show');
                allMobileNavItems.forEach(item => {
                    item.classList.remove('active');
                });
            }
        });
        
        // Initialize when the DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            // Desktop dropdown toggle functionality
            const navItems = document.querySelectorAll('.nav-item');
            
            navItems.forEach(item => {
                const link = item.querySelector('a');
                const dropdown = item.querySelector('.dropdown');
                
                if (dropdown) {
                    // Handle dropdown toggle for nav items with dropdowns
                    link.addEventListener('click', function(e) {
                        e.preventDefault();
                        
                        // Close all other dropdowns
                        navItems.forEach(otherItem => {
                            if (otherItem !== item) {
                                otherItem.classList.remove('active');
                            }
                        });
                        
                        // Toggle current dropdown
                        item.classList.toggle('active');
                    });
                } else {
                    // Handle direct navigation for items without dropdowns
                    link.addEventListener('click', function(e) {
                        // Don't prevent default for direct navigation
                        // The href will handle the navigation
                        
                        // Close all dropdowns when clicking on direct links
                        navItems.forEach(otherItem => {
                            otherItem.classList.remove('active');
                        });
                    });
                }
            });
            
            // Close dropdowns when clicking outside
            document.addEventListener('click', function(e) {
                const isNavClick = e.target.closest('.nav-item');
                const isMobileNavClick = e.target.closest('.mobile-nav');
                
                if (!isNavClick && !isMobileNavClick) {
                    navItems.forEach(item => {
                        item.classList.remove('active');
                    });
                }
            });
            
            setupAutomaticEventCheck();
        });
        
        // Close mobile nav when clicking outside
        document.addEventListener('click', function(e) {
            const mobileNav = document.getElementById('mobileNav');
            const hamburger = document.querySelector('.hamburger-menu');
            
            if (!hamburger.contains(e.target) && !mobileNav.contains(e.target)) {
                mobileNav.style.display = 'none';
                mobileNav.classList.remove('show');
                // Close all mobile dropdowns when clicking outside
                const allMobileNavItems = document.querySelectorAll('.mobile-nav-item');
                allMobileNavItems.forEach(item => {
                    item.classList.remove('active');
                });
            }
        });
    </script>
    
</body>
</html>